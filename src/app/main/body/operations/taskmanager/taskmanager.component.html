<app-new-task-dialog [(visible)]="showTaskDialog" [projectId]="projectId || 0" (visibleChange)="loadTasks()"
    [taskToEdit]="editTaskData"></app-new-task-dialog>
<main>
    <h2>Task Management</h2>

    <section class="tasks-table-section">
        <header class="tasks-table-section-header animate__animated animate__fadeIn animate__slow">
            <div class="top-statuses-container">
                <div (click)="loadTasks()" style="cursor: pointer;">ALL TASKS</div>
                <div (click)="loadTasks(1)" style="cursor: pointer;">TO DO</div>
                <div (click)="loadTasks(2)" style="cursor: pointer;">IN PROGRESS</div>
                <div (click)="loadTasks(3)" style="cursor: pointer;">DONE</div>
                <div (click)="loadTasks(4)" style="cursor: pointer;">IN REVIEW</div>
            </div>


            <button class="new-task-btn animate__animated animate__fadeInRight" (click)="openNewTaskDialog()">+ NEW
                TASK</button>

        </header>

        <p-table [value]="tasks" dataKey="id">
            <ng-template #header>
                <tr class="animate__animated animate__fadeIn">
                    <th>Title</th>
                    <th>Description</th>
                    <th>Activity Type</th>
                    <th>Due Date</th>
                    <th>Assigned To</th>
                    <th>Status</th>
                    <th>Actions</th> <!-- ✅ Add this -->
                </tr>
            </ng-template>

            <ng-template #body let-task>
                <tr class="animate__animated animate__fadeIn animate__slow">
                    <td>{{ task.title }}</td>
                    <td>{{ task.description }}</td>
                    <td>{{ task.activityTypeName }}</td>
                    <td>{{ task.endDate | date:'mediumDate' }}</td>
                    <td>{{ task.assigneeName }}</td>
                    <td>
                        <p-select [options]="statuses" [ngModel]="task.statusId"
                            (onChange)="onStatusChange(task, $event.value)" optionLabel="name" optionValue="id"
                            class="w-full md:w-56" [style.backgroundColor]="task.statusColor" [ngStyle]="{
                            'color': 'white',
                            'font-weight': 'bold',
                            'border-radius': '8px'
                        }" appendTo="body">
                        </p-select>
                    </td>

                    <!-- ✅ Add Action buttons -->
                    <td>
                        <button pButton icon="pi pi-pencil" class="p-button-text" (click)="editTask(task)"></button>
                        <button pButton icon="pi pi-trash" class="p-button-text p-button-danger"
                            (click)="deleteTask(task)"></button>
                    </td>
                </tr>
            </ng-template>
        </p-table>

    </section>
</main>